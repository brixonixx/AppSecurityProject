{% extends "base.html" %}
{% block title %}My Event Calendar{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-4">My Event Calendar</h2>
  <div class="row">
    <!-- Calendar -->
    <div class="col-md-8">
      <h4 id="monthYear" class="mb-3"></h4>
      <div class="d-flex flex-wrap" id="calendar">
        <!-- Days will be generated dynamically -->
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
      <div class="bg-light p-3 rounded">
        <h5><strong>Selected Date Events</strong></h5>
        <div id="eventBox" class="mt-3">Click a date to view events.</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<style>
  .calendar-day {
    width: 60px;
    height: 60px;
    margin: 5px;
    border-radius: 10px;
    background-color: #d3d3d3;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
  }
  .event-day {
    background-color: #aee4ff; /* blue for event days */
  }
  .selected {
    border: 2px solid black;
  }
  .today {
    border: 2px solid red;
  }
</style>

<script>
  const calendar = document.getElementById("calendar");
  const eventBox = document.getElementById("eventBox");
  const monthYear = document.getElementById("monthYear");
  let selectedDay = null;
  let events = {};

  async function fetchEvents(year, month) {
    const response = await fetch(`/api/events?year=${year}&month=${month}`);
    events = await response.json();
  }

  async function createCalendar() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth(); // 0-based
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    await fetchEvents(year, month + 1);

    monthYear.textContent = today.toLocaleString('default', { month: 'long', year: 'numeric' });
    calendar.innerHTML = "";

    for (let day = 1; day <= daysInMonth; day++) {
      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      const dayBox = document.createElement("div");
      dayBox.className = "calendar-day";
      if (events[dateStr]) dayBox.classList.add("event-day");
      if (day === today.getDate()) dayBox.classList.add("today");
      dayBox.textContent = day;

      dayBox.onclick = () => {
        if (selectedDay) selectedDay.classList.remove("selected");
        dayBox.classList.add("selected");
        selectedDay = dayBox;

        const items = events[dateStr];
        eventBox.innerHTML = items
          ? items.map(e => `<p>â€¢ <strong>${e}</strong></p>`).join('')
          : "No events for this day.";
      };

      calendar.appendChild(dayBox);
    }
  }

  createCalendar();
</script>
{% endblock %}
